/**
 * PgwSlideshow - Version 1.3
 *
 * Copyright 2014, Jonathan M. Piat
 * http://pgwjs.com - http://pagawa.com
 * 
 * Released under the GNU GPLv3 license - http://opensource.org/licenses/gpl-3.0
 */
(function(a){a.fn.pgwSlideshow=function(j){var e={mainClassName:"pgwSlideshow",displayList:true,touchControls:true,autoSlide:false,beforeSlide:false,afterSlide:false,transitionDuration:400,intervalDuration:3000};if(this.length==0){return this}else{if(this.length>1){this.each(function(){a(this).pgwSlideshow(j)});return this}}var f=this;f.plugin=this;f.config={};f.data=[];f.currentSlide=0;f.slideCount=0;f.eventInterval=null;f.touchCurrentFirstPosition=false;f.touchListLastPosition=false;var i=function(){f.config=a.extend({},e,j);d();if(f.config.displayList){f.checkList();a(window).resize(function(){f.checkList()})}if(f.config.autoSlide){g()}return true};var b=function(){var l=0;f.plugin.find("ul li").each(function(){l+=a(this).width()});f.plugin.find("ul").width(l);return true};var d=function(){f.plugin.removeClass(f.config.mainClassName);f.plugin.wrap('<div class="ps-list"></div>');f.plugin=f.plugin.parent();f.plugin.wrap('<div class="'+f.config.mainClassName+'"></div>');f.plugin=f.plugin.parent();f.plugin.prepend('<div class="ps-current"><img src="" alt=""></div>');f.slideCount=f.plugin.find("ul li").length;if(f.slideCount>1){f.plugin.find(".ps-current").prepend('<span class="ps-prev"><span class="ps-prevIcon"></span></span>');f.plugin.find(".ps-current").append('<span class="ps-next"><span class="ps-nextIcon"></span></span>');f.plugin.find(".ps-current").append('<span class="ps-caption"><span></span></span>');f.plugin.find(".ps-current .ps-prev").click(function(){f.previousSlide()});f.plugin.find(".ps-current .ps-next").click(function(){f.nextSlide()});if(f.config.touchControls){f.plugin.find(".ps-current").on("touchstart",function(m){try{if(m.originalEvent.touches[0].clientX&&f.touchCurrentFirstPosition==false){f.touchCurrentFirstPosition=m.originalEvent.touches[0].clientX}}catch(m){f.touchCurrentFirstPosition=false}});f.plugin.find(".ps-current").on("touchmove",function(m){try{if(m.originalEvent.touches[0].clientX&&f.touchCurrentFirstPosition!=false){if(m.originalEvent.touches[0].clientX>(f.touchCurrentFirstPosition+50)){f.touchCurrentFirstPosition=false;f.previousSlide()}else{if(m.originalEvent.touches[0].clientX<(f.touchCurrentFirstPosition-50)){f.touchCurrentFirstPosition=false;f.nextSlide()}}}}catch(m){f.touchCurrentFirstPosition=false}});f.plugin.find(".ps-current").on("touchend",function(m){f.touchCurrentFirstPosition=false})}}var l=1;f.plugin.find("ul li").each(function(){var m=c(a(this));m.id=l;f.data.push(m);a(this).addClass("elt_"+m.id);a(this).wrapInner('<span class="ps-item'+(l==1?" ps-selected":"")+'"></span>');a(this).css("cursor","pointer").click(function(n){n.preventDefault();k(m.id)});l++});if(f.config.displayList){b();f.plugin.find(".ps-list").prepend('<span class="ps-prev"><span class="ps-prevIcon"></span></span>');f.plugin.find(".ps-list").append('<span class="ps-next"><span class="ps-nextIcon"></span></span>');f.plugin.find(".ps-list").show()}else{f.plugin.find(".ps-list").hide()}if(f.config.autoSlide){f.plugin.on("mouseenter",function(){clearInterval(f.eventInterval);f.eventInterval=null}).on("mouseleave",function(){g()})}k(1);return true};var c=function(q){var p={};var n=q.find("a").attr("href");if((typeof n!="undefined")&&(n!="")){p.link=n;var o=q.find("a").attr("target");if((typeof o!="undefined")&&(o!="")){p.linkTarget=o}}var m=q.find("img").attr("src");if((typeof m!="undefined")&&(m!="")){p.thumbnail=m}var r=q.find("img").attr("data-large-src");if((typeof r!="undefined")&&(r!="")){p.image=r}var l=q.find("img").attr("alt");if((typeof l!="undefined")&&(l!="")){p.title=l}return p};var k=function(l,o){var n=f.data[l-1];var m=f.plugin.find(".ps-current");if(typeof n=="undefined"){throw new Error("PgwSlideshow - The element "+l+" is undefined");return false}f.currentSlide=l;if(typeof f.config.beforeSlide=="function"){f.config.beforeSlide(l)}if(typeof m.animate=="undefined"){m.animate=function(p,q,r){m.css(p);if(r){r()}}}if(typeof m.stop=="function"){m.stop()}m.animate({opacity:0},f.config.transitionDuration,function(){f.plugin.find("ul li .ps-item").removeClass("ps-selected");f.plugin.find("ul li.elt_"+l+" .ps-item").addClass("ps-selected");if(n.image){m.find("img").attr("src",n.image);m.find("img").attr("alt",(n.title?n.title:""))}else{if(n.thumbnail){m.find("img").attr("src",n.thumbnail);m.find("img").attr("alt",(n.title?n.title:""))}else{m.html("")}}if(n.title){m.find(".ps-caption span").text(n.title);m.find(".ps-caption").show()}else{m.find(".ps-caption span").text("");m.find(".ps-caption").hide()}if(f.config.displayList){h()}if(typeof f.config.afterSlide=="function"){f.config.afterSlide(l)}m.animate({opacity:1},f.config.transitionDuration)});if(typeof o!="undefined"&&f.config.autoSlide){g()}return true};var g=function(){clearInterval(f.eventInterval);if(f.slideCount>1&&f.config.autoSlide){f.eventInterval=setInterval(function(){if(f.currentSlide+1<=f.slideCount){var l=f.currentSlide+1}else{var l=1}k(l)},f.config.intervalDuration)}return true};f.checkList=function(){if(!f.config.displayList){return false}b();var q=f.plugin.find(".ps-list");var o=q.width();var l=f.plugin.find(".ps-list ul");var p=l.width();if(p>o){l.css("margin","0 45px");var n=parseInt(l.css("margin-left"));var m=parseInt(l.css("margin-right"));o-=(n+m);q.find(".ps-prev").show().unbind("click").click(function(){var s=parseInt(l.css("left"));var r=s+o;if(s==0){r=-(p-o)}else{if(r>0){r=0}}l.css("left",r)});q.find(".ps-next").show().unbind("click").click(function(){var s=parseInt(l.css("left"));var r=s-o;var t=-(p-o);if(s==t){r=0}else{if(r<t){r=t}}l.css("left",r)});if(f.config.touchControls){f.plugin.find(".ps-list ul").on("touchmove",function(w){try{if(w.originalEvent.touches[0].clientX){var A=(f.touchListLastPosition==false?0:f.touchListLastPosition);nbPixels=(f.touchListLastPosition==false?1:Math.abs(A-w.originalEvent.touches[0].clientX));f.touchListLastPosition=w.originalEvent.touches[0].clientX;var r="";if(A>w.originalEvent.touches[0].clientX){r="left"}else{if(A<w.originalEvent.touches[0].clientX){r="right"}}}var z=parseInt(l.css("left"));if(r=="left"){var y=q.width();var x=l.width();var t=parseInt(l.css("margin-left"));var v=parseInt(l.css("margin-right"));y-=(t+v);var u=-(x-y);var s=z-nbPixels;if(s>u){l.css("left",s)}}else{if(r=="right"){var s=z+nbPixels;if(s<0){l.css("left",s)}else{l.css("left",0)}}}}catch(w){f.touchListLastPosition=false}});f.plugin.find(".ps-list ul").on("touchend",function(r){f.touchListLastPosition=false})}}else{var n=parseInt((o-p)/2);l.css("left",0).css("margin-left",n);q.find(".ps-prev").hide();q.find(".ps-next").hide();f.plugin.find(".ps-list ul").unbind("touchstart touchmove touchend")}return true};var h=function(){var u=f.plugin.find(".ps-list").width();var s=f.plugin.find(".ps-list ul");var t=s.width();var n=parseInt(s.css("margin-left"));var r=parseInt(s.css("margin-right"));u-=(n+r);var q=Math.abs(parseInt(s.css("left")));var l=q+u;var o=f.plugin.find(".ps-list .ps-selected").position().left;var m=o+f.plugin.find(".ps-list .ps-selected").width();if((o<q)||(m>l)){var p=-(t-u);if(-o<p){s.css("left",p)}else{s.css("left",-o)}}return true};f.startSlide=function(){f.config.autoSlide=true;g();return true};f.stopSlide=function(){f.config.autoSlide=false;clearInterval(f.eventInterval);return true};f.getCurrentSlide=function(){return f.currentSlide};f.getSlideCount=function(){return f.slideCount};f.displaySlide=function(l){k(l,true);return true};f.nextSlide=function(){if(f.currentSlide+1<=f.slideCount){var l=f.currentSlide+1}else{var l=1}k(l,true);return true};f.previousSlide=function(){if(f.currentSlide-1>=1){var l=f.currentSlide-1}else{var l=f.slideCount}k(l,true);return true};f.destroy=function(l){clearInterval(f.eventInterval);f.plugin.find("ul li").each(function(){a(this).unbind("click")});var m=f.config.mainClassName;f.data=[];f.config={};f.currentSlide=0;f.slideCount=0;f.eventInterval=null;if(typeof l!="undefined"){if(f.plugin.find("div").length>0){f.plugin.find("ul").unwrap();f.plugin.children().not("ul").remove();f.plugin=f.plugin.find("ul");f.plugin.removeClass().attr("style",null);f.plugin.addClass(m);f.plugin.unwrap();f.plugin.hide();f.plugin.find("li").each(function(){a(this).find("img").unwrap();a(this).removeClass().attr("style",null)})}}else{f.parent().parent().remove();f.plugin=null;f=null}return true};f.reload=function(l){f.destroy(true);f=this;f.plugin=this;f.plugin.show();f.config=a.extend({},e,l);d();if(f.config.displayList){f.checkList();a(window).resize(function(){f.checkList()})}if(f.config.autoSlide){g()}return true};i();return this}})(window.Zepto||window.jQuery);
