/**
 * PgwSlideshow - Version 1.0
 *
 * Copyright 2014, Jonathan M. Piat
 * http://pgwjs.com - http://pagawa.com
 * 
 * Released under the GNU GPLv3 license - http://opensource.org/licenses/gpl-3.0
 */
(function(a){a.fn.pgwSlideshow=function(i){var e={displayList:true,touchControls:true,transitionDuration:400,beforeSlide:false,afterSlide:false};if(this.length==0){return this}else{if(this.length>1){this.each(function(){a(this).pgwSlideshow(i)});return this}}var f={};f.plugin=this;f.config={};f.data=[];f.currentSlide=0;f.slideCount=0;f.touchCurrentFirstPosition=false;f.touchListLastPosition=false;var h=function(){f.config=a.extend({},e,i);d();if(f.config.displayList){f.checkList();a(window).resize(function(){f.checkList()})}return true};var b=function(){var k=0;f.plugin.find("ul li").each(function(){k+=a(this).width()});f.plugin.find("ul").width(k);return true};var d=function(){f.plugin.removeClass("pgwSlideshow");f.plugin.wrap('<div class="ps-list"></div>');f.plugin=f.plugin.parent();f.plugin.wrap('<div class="pgwSlideshow"></div>');f.plugin=f.plugin.parent();f.plugin.prepend('<div class="ps-current"><img src="" alt=""></div>');f.slideCount=f.plugin.find("ul li").length;if(f.slideCount>1){f.plugin.find(".ps-current").prepend('<span class="ps-prev"><span class="ps-prevIcon"></span></span>');f.plugin.find(".ps-current").append('<span class="ps-next"><span class="ps-nextIcon"></span></span>');f.plugin.find(".ps-current").append('<span class="ps-caption"><span></span></span>');f.plugin.find(".ps-current .ps-prev").click(function(){f.previousSlide()});f.plugin.find(".ps-current .ps-next").click(function(){f.nextSlide()});if(f.config.touchControls){f.plugin.find(".ps-current").on("touchstart",function(l){try{if(l.originalEvent.touches[0].clientX&&f.touchCurrentFirstPosition==false){f.touchCurrentFirstPosition=l.originalEvent.touches[0].clientX}}catch(l){f.touchCurrentFirstPosition=false}});f.plugin.find(".ps-current").on("touchmove",function(l){try{if(l.originalEvent.touches[0].clientX&&f.touchCurrentFirstPosition!=false){if(l.originalEvent.touches[0].clientX>(f.touchCurrentFirstPosition+50)){f.touchCurrentFirstPosition=false;f.previousSlide()}else{if(l.originalEvent.touches[0].clientX<(f.touchCurrentFirstPosition-50)){f.touchCurrentFirstPosition=false;f.nextSlide()}}}}catch(l){f.touchCurrentFirstPosition=false}});f.plugin.find(".ps-current").on("touchend",function(l){f.touchCurrentFirstPosition=false})}}var k=1;f.plugin.find("ul li").each(function(){var l=c(a(this));l.id=k;f.data.push(l);a(this).addClass("elt_"+l.id);a(this).wrapInner('<span class="ps-item'+(k==1?" ps-selected":"")+'"></span>');a(this).css("cursor","pointer").click(function(m){m.preventDefault();j(l.id)});k++});if(f.config.displayList){b();f.plugin.find(".ps-list").prepend('<span class="ps-prev"><span class="ps-prevIcon"></span></span>');f.plugin.find(".ps-list").append('<span class="ps-next"><span class="ps-nextIcon"></span></span>');f.plugin.find(".ps-list").show()}else{f.plugin.find(".ps-list").hide()}j(1);return true};var c=function(p){var o={};var m=p.find("a").attr("href");if((typeof m!="undefined")&&(m!="")){o.link=m;var n=p.find("a").attr("target");if((typeof n!="undefined")&&(n!="")){o.linkTarget=n}}var l=p.find("img").attr("src");if((typeof l!="undefined")&&(l!="")){o.thumbnail=l}var q=p.find("img").attr("data-large-src");if((typeof q!="undefined")&&(q!="")){o.image=q}var k=p.find("img").attr("alt");if((typeof k!="undefined")&&(k!="")){o.title=k}return o};var j=function(k,n){var m=f.data[k-1];var l=f.plugin.find(".ps-current");if(typeof m=="undefined"){throw new Error("PgwSlideshow - The element "+k+" is undefined");return false}f.currentSlide=k;if(typeof f.config.beforeSlide=="function"){f.config.beforeSlide(k)}if(typeof l.animate=="undefined"){l.animate=function(o,p,q){l.css(o);if(q){q()}}}l.stop().animate({opacity:0},f.config.transitionDuration,function(){f.plugin.find("ul li .ps-item").removeClass("ps-selected");f.plugin.find("ul li.elt_"+k+" .ps-item").addClass("ps-selected");if(m.image){l.find("img").attr("src",m.image);l.find("img").attr("alt",(m.title?m.title:""))}else{if(m.thumbnail){l.find("img").attr("src",m.thumbnail);l.find("img").attr("alt",(m.title?m.title:""))}else{l.html("")}}if(m.title){l.find(".ps-caption span").text(m.title);l.find(".ps-caption").show()}else{l.find(".ps-caption span").text("");l.find(".ps-caption").hide()}if(f.config.displayList){g()}if(typeof f.config.afterSlide=="function"){f.config.afterSlide(k)}l.animate({opacity:1},f.config.transitionDuration)});return true};f.checkList=function(){if(!f.config.displayList){return false}b();var p=f.plugin.find(".ps-list");var n=p.width();var k=f.plugin.find(".ps-list ul");var o=k.width();if(o>n){k.css("margin","0 45px");var m=parseInt(k.css("margin-left"));var l=parseInt(k.css("margin-right"));n-=(m+l);p.find(".ps-prev").show().unbind("click").click(function(){var r=parseInt(k.css("left"));var q=r+n;if(r==0){q=-(o-n)}else{if(q>0){q=0}}k.css("left",q)});p.find(".ps-next").show().unbind("click").click(function(){var r=parseInt(k.css("left"));var q=r-n;var s=-(o-n);if(r==s){q=0}else{if(q<s){q=s}}k.css("left",q)});if(f.config.touchControls){f.plugin.find(".ps-list ul").on("touchmove",function(v){try{if(v.originalEvent.touches[0].clientX){var z=(f.touchListLastPosition==false?0:f.touchListLastPosition);nbPixels=(f.touchListLastPosition==false?1:Math.abs(z-v.originalEvent.touches[0].clientX));f.touchListLastPosition=v.originalEvent.touches[0].clientX;var q="";if(z>v.originalEvent.touches[0].clientX){q="left"}else{if(z<v.originalEvent.touches[0].clientX){q="right"}}}var y=parseInt(k.css("left"));if(q=="left"){var x=p.width();var w=k.width();var s=parseInt(k.css("margin-left"));var u=parseInt(k.css("margin-right"));x-=(s+u);var t=-(w-x);var r=y-nbPixels;if(r>t){k.css("left",r)}}else{if(q=="right"){var r=y+nbPixels;if(r<0){k.css("left",r)}else{k.css("left",0)}}}}catch(v){f.touchListLastPosition=false}});f.plugin.find(".ps-list ul").on("touchend",function(q){f.touchListLastPosition=false})}}else{var m=parseInt((n-o)/2);k.css("left",0).css("margin-left",m);p.find(".ps-prev").hide();p.find(".ps-next").hide();f.plugin.find(".ps-list ul").unbind("touchstart touchmove touchend")}return true};var g=function(){var t=f.plugin.find(".ps-list").width();var r=f.plugin.find(".ps-list ul");var s=r.width();var m=parseInt(r.css("margin-left"));var q=parseInt(r.css("margin-right"));t-=(m+q);var p=Math.abs(parseInt(r.css("left")));var k=p+t;var n=f.plugin.find(".ps-list .ps-selected").position().left;var l=n+f.plugin.find(".ps-list .ps-selected").width();if((n<p)||(l>k)){var o=-(s-t);if(-n<o){r.css("left",o)}else{r.css("left",-n)}}return true};f.getCurrentSlide=function(){return f.currentSlide};f.getSlideCount=function(){return f.slideCount};f.displaySlide=function(k){j(k,true);return true};f.nextSlide=function(){if(f.currentSlide+1<=f.slideCount){var k=f.currentSlide+1}else{var k=1}j(k,true);return true};f.previousSlide=function(){if(f.currentSlide-1>=1){var k=f.currentSlide-1}else{var k=f.slideCount}j(k,true);return true};h();return this}})(window.Zepto||window.jQuery);
